<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Creator Pro V5 Stable Final</title>

<style>
body {
margin:0;
background:black;
color:white;
font-family:Arial, sans-serif;
display:flex;
flex-direction:column;
height:100vh;
}

#control {
padding:10px;
background:#111;
}

textarea {
width:100%;
height:130px;
background:#000;
color:white;
border:1px solid #333;
border-radius:6px;
padding:10px;
font-size:14px;
}

button {
width:100%;
padding:12px;
margin-top:8px;
border:none;
border-radius:6px;
background:#16a34a;
color:white;
font-weight:bold;
font-size:16px;
}

#player {
flex:1;
display:flex;
align-items:center;
justify-content:center;
padding:20px;
text-align:center;
font-size:28px;
line-height:1.4;
}
</style>
</head>

<body>

<div id="control">
<textarea id="textInput" placeholder="Paste cerita (pisahkan paragraf dengan ENTER)..."></textarea>

<button onclick="generate()">GENERATE SCENE</button>
<button onclick="play()">PLAY TYPEWRITER</button>
<button onclick="startRecord()">START RECORD</button>
<button onclick="stopRecord()">STOP RECORD</button>
</div>

<div id="player">
Ready...
</div>

<script>

// =======================
// GLOBAL STATE
// =======================

let scenes = [];
let currentScene = 0;
let charIndex = 0;
let typingTimer = null;
let paused = false;

let mediaRecorder;
let recordedChunks = [];

// =======================
// GENERATE SCENE
// =======================

function generate(){

let text = document.getElementById("textInput").value;

if(text.trim().length < 20){
document.getElementById("player").innerHTML = "âš ï¸ Masukkan cerita dulu";
return;
}

let parts = text.split(/\n+/).filter(p => p.trim() !== "");

scenes = [];

// SPLIT 3 PARAGRAF PER SCENE
for(let i=0; i<parts.length; i+=3){
scenes.push(parts.slice(i, i+3).join(" "));
}

currentScene = 0;
charIndex = 0;

document.getElementById("player").innerHTML =
"âœ… Scene siap: " + scenes.length + "<br>Tekan PLAY";

console.log("Scenes:", scenes);
}

// =======================
// PLAY TYPEWRITER
// =======================

function play(){

if(scenes.length === 0){
document.getElementById("player").innerHTML = "âš ï¸ Klik GENERATE dulu";
return;
}

paused = false;
runTyping();
}

function runTyping(){

clearInterval(typingTimer);

if(currentScene >= scenes.length){
document.getElementById("player").innerHTML += "<br><br>âœ”ï¸ Selesai";
return;
}

let player = document.getElementById("player");
let text = scenes[currentScene];

typingTimer = setInterval(()=>{

if(paused) return;

player.innerHTML = text.substring(0, charIndex);
charIndex++;

if(charIndex > text.length){
clearInterval(typingTimer);

setTimeout(()=>{
currentScene++;
charIndex = 0;
runTyping();
},1200);

}

},35); // SPEED VIRAL NORMAL
}

// =======================
// RECORD VIDEO
// =======================

async function startRecord(){

let stream = await navigator.mediaDevices.getDisplayMedia({
video: { frameRate: 60 },
audio: false
});

mediaRecorder = new MediaRecorder(stream, {
mimeType: "video/webm"
});

recordedChunks = [];

mediaRecorder.ondataavailable = e => {
if(e.data.size > 0){
recordedChunks.push(e.data);
}
};

mediaRecorder.onstop = () => {

let blob = new Blob(recordedChunks, { type: "video/webm" });
let url = URL.createObjectURL(blob);

let a = document.createElement("a");
a.href = url;
a.download = "creator_pro_video.webm";
a.click();

};

mediaRecorder.start();

document.getElementById("player").innerHTML = "ðŸ”´ Recording...";
}

// =======================
// STOP RECORD
// =======================

function stopRecord(){
if(mediaRecorder){
mediaRecorder.stop();
}
}

// =======================
// TAB SAFE MODE
// =======================

document.addEventListener("visibilitychange", ()=>{

if(document.hidden){
paused = true;
}else{
paused = false;
}

});

</script>

</body>
</html>
