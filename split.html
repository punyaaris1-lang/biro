<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Creator Pro V5.3 Media Mode</title>

<style>
body{
margin:0;
background:black;
color:white;
font-family:Arial;
display:flex;
flex-direction:column;
height:100vh;
}

#control{
background:#111;
padding:10px;
}

textarea{
width:100%;
height:110px;
background:#000;
color:white;
border:1px solid #333;
border-radius:6px;
padding:8px;
}

select,input,button{
width:100%;
padding:10px;
margin-top:6px;
border-radius:6px;
border:none;
font-size:14px;
}

button{
background:#16a34a;
color:white;
font-weight:bold;
}

#player{
flex:1;
display:flex;
align-items:center;
justify-content:center;
text-align:center;
padding:20px;
font-size:28px;
line-height:1.4;
background:black;
background-size:cover;
background-position:center;
}
</style>
</head>

<body>

<div id="control">

<textarea id="textInput" placeholder="Paste cerita..."></textarea>

<select onchange="changeBG(this.value)">
<option value="black">Hitam Cinematic</option>
<option value="gradient">Gradient Gelap</option>
</select>

<input type="file" accept="image/*" onchange="uploadBG(this)">

<button onclick="generate()">GENERATE</button>
<button onclick="play()">PLAY</button>
<button onclick="startRecord()">START RECORD</button>
<button onclick="stopRecord()">STOP RECORD</button>

</div>

<div id="player">READY</div>

<script>

// ===== STATE =====

let scenes=[];
let currentScene=0;
let charIndex=0;
let timer=null;
let paused=false;

let mediaRecorder;
let recordedChunks=[];

// ===== BACKGROUND =====

function changeBG(mode){
let p=document.getElementById("player");

if(mode==="black"){
p.style.background="black";
}
if(mode==="gradient"){
p.style.background="linear-gradient(120deg,#020024,#090979,#000)";
}
}

function uploadBG(input){
let file=input.files[0];
let reader=new FileReader();
reader.onload=e=>{
document.getElementById("player").style.background=`url(${e.target.result})`;
};
reader.readAsDataURL(file);
}

// ===== MUSIC GENERATOR (SAFE) =====

let audioCtx;
let osc;
let gainNode;

function startMusic(){

audioCtx=new (window.AudioContext||window.webkitAudioContext)();

osc=audioCtx.createOscillator();
gainNode=audioCtx.createGain();

osc.type="sine";
osc.frequency.value=174; // cinematic ambient

gainNode.gain.value=0.05;

osc.connect(gainNode);
gainNode.connect(audioCtx.destination);

osc.start();
}

function stopMusic(){
if(osc){
osc.stop();
}
}

// ===== GENERATE =====

function generate(){

let text=document.getElementById("textInput").value;

if(text.trim().length<20){
document.getElementById("player").innerHTML="Masukin cerita dulu";
return;
}

let parts=text.split(/\n+/).filter(x=>x.trim()!="");

scenes=[];

for(let i=0;i<parts.length;i+=3){
scenes.push(parts.slice(i,i+3).join(" "));
}

currentScene=0;
charIndex=0;

document.getElementById("player").innerHTML="Scene siap: "+scenes.length;

}

// ===== PLAY TYPEWRITER =====

function play(){

if(scenes.length==0){
document.getElementById("player").innerHTML="Klik generate dulu";
return;
}

startMusic();

paused=false;
runTyping();
}

function runTyping(){

clearInterval(timer);

if(currentScene>=scenes.length){
document.getElementById("player").innerHTML+="<br>SELESAI";
stopMusic();
return;
}

let player=document.getElementById("player");
let txt=scenes[currentScene];

timer=setInterval(()=>{

if(paused) return;

player.innerHTML=txt.substring(0,charIndex);
charIndex++;

if(charIndex>txt.length){
clearInterval(timer);
setTimeout(()=>{
currentScene++;
charIndex=0;
runTyping();
},1200);
}

},35);

}

// ===== RECORD =====

async function startRecord(){

let stream=await navigator.mediaDevices.getDisplayMedia({
video:{frameRate:60},
audio:true
});

mediaRecorder=new MediaRecorder(stream);

recordedChunks=[];

mediaRecorder.ondataavailable=e=>{
if(e.data.size>0) recordedChunks.push(e.data);
};

mediaRecorder.onstop=()=>{

let blob=new Blob(recordedChunks,{type:"video/webm"});
let url=URL.createObjectURL(blob);

let a=document.createElement("a");
a.href=url;
a.download="creator_video_pro.webm";
a.click();

};

mediaRecorder.start();

document.getElementById("player").innerHTML="RECORDING...";
}

function stopRecord(){
if(mediaRecorder){
mediaRecorder.stop();
}
}

// ===== TAB SAFE =====

document.addEventListener("visibilitychange",()=>{
paused=document.hidden;
});

</script>

</body>
</html>
