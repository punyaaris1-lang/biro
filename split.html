<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Creator Pro V5 Stable</title>

<style>
body {
margin:0;
background:black;
color:white;
font-family:Arial;
display:flex;
flex-direction:column;
height:100vh;
}

#control {
padding:10px;
background:#111;
}

textarea {
width:100%;
height:120px;
background:#000;
color:white;
border:1px solid #333;
border-radius:6px;
padding:8px;
}

button {
width:100%;
padding:12px;
margin-top:8px;
border:none;
border-radius:6px;
background:#16a34a;
color:white;
font-weight:bold;
font-size:16px;
}

#player {
flex:1;
display:flex;
align-items:center;
justify-content:center;
padding:20px;
text-align:center;
font-size:28px;
line-height:1.4;
}
</style>
</head>

<body>

<div id="control">
<textarea id="textInput" placeholder="Paste cerita disini..."></textarea>
<button onclick="generate()">GENERATE SCENE</button>
<button onclick="startPlayback()">PLAY</button>
<button onclick="startRecord()">START RECORD</button>
<button onclick="stopRecord()">STOP RECORD</button>
</div>

<div id="player"></div>

<script>
let scenes=[];
let currentScene=0;
let charIndex=0;
let typingInterval=null;
let paused=false;

let mediaRecorder;
let recordedChunks=[];

function generate(){
let text=document.getElementById("textInput").value.trim();
if(!text){ alert("Masukkan teks"); return;}

let parts=text.split(/\n+/).filter(x=>x.trim()!="");

scenes=[];
for(let i=0;i<parts.length;i+=3){
scenes.push(parts.slice(i,i+3).join(" "));
}

alert("Scene dibuat: "+scenes.length);
}

function startPlayback(){
if(!scenes.length){
alert("Generate dulu");
return;
}

paused=false;
runTyping();
}

function runTyping(){

if(currentScene>=scenes.length){
clearInterval(typingInterval);
return;
}

let player=document.getElementById("player");

typingInterval=setInterval(()=>{

if(paused) return;

let txt=scenes[currentScene];

player.innerHTML = txt.substring(0,charIndex);
charIndex++;

if(charIndex>txt.length){
clearInterval(typingInterval);
setTimeout(()=>{
currentScene++;
charIndex=0;
runTyping();
},1200);
}

,35); // viral speed
}

async function startRecord(){

let stream=await navigator.mediaDevices.getDisplayMedia({
video:{frameRate:60},
audio:false
});

mediaRecorder=new MediaRecorder(stream,{mimeType:"video/webm"});
recordedChunks=[];

mediaRecorder.ondataavailable=e=>{
if(e.data.size>0) recordedChunks.push(e.data);
};

mediaRecorder.onstop=()=>{
let blob=new Blob(recordedChunks,{type:"video/webm"});
let url=URL.createObjectURL(blob);
let a=document.createElement("a");
a.href=url;
a.download="creator_pro_v5_stable.webm";
a.click();
};

mediaRecorder.start();
}

function stopRecord(){
if(mediaRecorder){
mediaRecorder.stop();
}
}

/* ===== TAB SAFE MODE ===== */

document.addEventListener("visibilitychange", ()=>{

if(document.hidden){
paused=true;
console.log("Paused (tab hidden)");
}else{
paused=false;
console.log("Resumed");
}

});
</script>

</body>
</html>
